<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Notes </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fff"/>
</head>
<body class="bg-gray-100">
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <img src="images/letter-n.png" alt="Logo" class="h-8 w-8 rounded-full">
                <span class="text-xl font-bold">Notes</span>
            </a>
        </div>
    </nav>
    <div class="container mx-auto mt-6 px-4">
        <div class="bg-white rounded-lg shadow-xl p-4">
            <form id="add-note-form" action="/add" method="post" class="flex items-center">
                <input type="text" class="flex-grow appearance-none bg-transparent border-none w-full text-gray-700 mr-3 py-2 px-4 leading-tight focus:outline-none" placeholder="Write a new note..." name="note" required>
                <button class="flex-shrink-0 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg" type="submit">
                    Add
                </button>
            </form>
        </div>
    </div>

    <div id="notes-container" class="container mx-auto px-4 mt-4 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        <!-- Notes will be added here dynamically -->
    </div>

    <button id="installBtn" style="display: none;" class="fixed bottom-8 right-8 bg-blue-500 hover:bg-blue-700 text-white font-bold w-20 h-20 rounded-full flex items-center justify-center shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
    </button>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
            .then((reg) => {
                console.log('Service worker registered.', reg);
            });
        }

        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex'; // Changed to flex to center the icon
        });

        installBtn.addEventListener('click', (e) => {
            installBtn.style.display = 'none';
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
            });
        });

        const addNoteForm = document.getElementById('add-note-form');
        const notesContainer = document.getElementById('notes-container');
        const noteInput = addNoteForm.querySelector('input[name="note"]');

        addNoteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const noteText = noteInput.value.trim();
            if (noteText !== '') {
                createNoteElement(noteText);
                noteInput.value = '';
                noteInput.focus();
            }
        });

        function createNoteElement(text) {
            const noteElement = document.createElement('div');
            noteElement.classList.add('bg-white', 'p-4', 'rounded-lg', 'shadow-md', 'flex', 'flex-col');

            const textElement = document.createElement('p');
            textElement.classList.add('note-text', 'flex-grow');
            textElement.textContent = text;

            const buttonContainer = document.createElement('div');
            buttonContainer.classList.add('flex', 'space-x-2', 'mt-3');

            const toIdButton = document.createElement('button');
            toIdButton.classList.add('translate-btn', 'bg-gray-200', 'hover:bg-gray-300', 'text-gray-700', 'py-1', 'px-2', 'rounded-md', 'text-sm');
            toIdButton.textContent = 'to Indonesian';
            toIdButton.dataset.direction = 'en|id';

            const toEnButton = document.createElement('button');
            toEnButton.classList.add('translate-btn', 'bg-gray-200', 'hover:bg-gray-300', 'text-gray-700', 'py-1', 'px-2', 'rounded-md', 'text-sm');
            toEnButton.textContent = 'to English';
            toEnButton.dataset.direction = 'id|en';

            buttonContainer.appendChild(toIdButton);
            buttonContainer.appendChild(toEnButton);

            const translationResult = document.createElement('p');
            translationResult.classList.add('translation-result', 'mt-2', 'text-gray-500', 'text-sm', 'italic');

            noteElement.appendChild(textElement);
            noteElement.appendChild(buttonContainer);
            noteElement.appendChild(translationResult);

            notesContainer.prepend(noteElement);
        }

        notesContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('translate-btn')) {
                const noteElement = e.target.closest('.shadow-md');
                const textToTranslate = noteElement.querySelector('.note-text').textContent;
                const resultElement = noteElement.querySelector('.translation-result');
                const translateButton = e.target;
                const direction = translateButton.dataset.direction;

                const buttons = noteElement.querySelectorAll('.translate-btn');
                buttons.forEach(button => button.disabled = true);
                translateButton.textContent = 'Translating...';

                fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=${direction}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.responseData) {
                            resultElement.textContent = data.responseData.translatedText;
                        } else {
                            resultElement.textContent = 'Translation not found.';
                        }
                    })
                    .catch(error => {
                        console.error('Translation error:', error);
                        resultElement.textContent = 'Translation failed.';
                    })
                    .finally(() => {
                        buttons.forEach(button => button.disabled = false);
                        noteElement.querySelector('[data-direction="en|id"]').textContent = 'to Indonesian';
                        noteElement.querySelector('[data-direction="id|en"]').textContent = 'to English';
                    });
            }
        });
    </script>
</body>
</html>