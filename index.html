<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes — Bilingual, Fast, and Interactive</title>
    <meta name="description" content="A beautiful, fast, and interactive bilingual notes app. Add, search, sort, edit, and manage English–Indonesian word pairs with offline support.">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Enable class-based dark mode for Tailwind CDN build
      tailwind.config = { darkMode: 'class' };
    </script>

    <link rel="manifest" href="manifest.json">
    <meta id="theme-color" name="theme-color" content="#ffffff" />
    <link rel="icon" href="images/letter-n.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
      :root { --ring: 62 100% 67%; }
      html { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      /* Card flip */
      .flip { perspective: 1000px; }
      .flip-inner { transform-style: preserve-3d; transition: transform .6s; }
      .flip[data-flipped="true"] .flip-inner { transform: rotateY(180deg); }
      .flip-face { backface-visibility: hidden; }
      .flip-back { transform: rotateY(180deg); }
      /* Fancy gradient ring */
      .brand-ring { box-shadow: 0 0 0 4px hsl(var(--ring) / .2); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Top Navigation -->
    <nav class="sticky top-0 z-40 backdrop-blur bg-white/70 dark:bg-gray-900/70 border-b border-gray-200/70 dark:border-gray-800">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="h-16 flex items-center justify-between">
          <a href="#" class="flex items-center gap-3 group">
            <img src="images/letter-n.png" alt="Notes logo" class="h-9 w-9 rounded-full brand-ring group-hover:scale-105 transition" />
            <div>
              <div class="text-xl font-bold tracking-tight">Notes</div>
              <div class="text-xs text-gray-500 dark:text-gray-400">English ↔ Indonesian</div>
            </div>
          </a>
          <div class="flex items-center gap-3">
            <div class="relative hidden sm:block">
              <input id="search-input" type="search" placeholder="Search notes... (/)" class="w-64 rounded-xl border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-gray-800/70 px-4 py-2 pl-9 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <svg class="absolute left-2.5 top-2.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"/></svg>
            </div>
            <button id="theme-toggle" class="inline-flex items-center gap-2 rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800" aria-label="Toggle dark mode">
              <svg id="theme-icon-sun" class="h-5 w-5 hidden dark:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364l-1.414-1.414M7.05 7.05L5.636 5.636m12.728 0L17.95 7.05M7.05 16.95l-1.414 1.414"/></svg>
              <svg id="theme-icon-moon" class="h-5 w-5 dark:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
              <span class="hidden sm:inline">Theme</span>
            </button>
            <button id="review-btn" class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 text-white px-3 py-2 text-sm hover:bg-emerald-700" title="Start review (R)">
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              <span class="hidden sm:inline">Review</span>
            </button>
            <span id="due-badge" class="ml-1 inline-flex items-center rounded-full bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200 text-xs font-semibold px-2 py-1">0 due</span>
            <span id="count-badge" class="ml-1 inline-flex items-center rounded-full bg-blue-600 text-white text-xs font-semibold px-2 py-1">0</span>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero -->
    <header class="relative overflow-hidden">
      <div class="pointer-events-none absolute inset-0 bg-gradient-to-br from-blue-50 via-transparent to-purple-50 dark:from-blue-900/20 dark:to-purple-900/10"></div>
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">Capture bilingual notes with style</h1>
            <p class="mt-3 text-gray-600 dark:text-gray-400">Add English–Indonesian pairs, search instantly, flip to reveal, edit inline, and keep everything offline.</p>
            <ul class="mt-4 text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <li>• Press / to search, N to add a new note, and D to toggle dark mode.</li>
            </ul>
          </div>
          <div class="md:justify-self-end">
            <div class="rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-800/70 p-4 shadow-sm">
              <div class="text-xs uppercase tracking-wider text-gray-500 mb-2">Quick Add</div>
              <form id="add-note-form" class="space-y-2">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                  <label class="sr-only" for="english_word">English</label>
                  <input id="english_word" name="english_word" type="text" placeholder="English word" class="rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                  <label class="sr-only" for="indonesian_word">Indonesian</label>
                  <input id="indonesian_word" name="indonesian_word" type="text" placeholder="Indonesian translation" class="rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                  <label class="sr-only" for="tags_input">Tags</label>
                  <input id="tags_input" name="tags_input" type="text" placeholder="Tags (optional, comma-separated)" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center gap-2">
                  <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 text-white px-4 py-2 font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    Add note
                  </button>
                  <button id="clear-all" type="button" class="ml-auto inline-flex items-center justify-center gap-2 rounded-xl border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Clear all</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Toolbar -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
      <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
        <div class="sm:hidden">
          <input id="search-input-mobile" type="search" placeholder="Search notes... (/)" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-gray-800/70 px-4 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex flex-wrap items-center gap-3">
          <div class="flex flex-wrap items-center gap-2 text-sm">
            <label for="sort-select" class="text-gray-500 dark:text-gray-400">Sort</label>
            <select id="sort-select" class="rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="a-z">A → Z (English)</option>
              <option value="z-a">Z → A (English)</option>
            </select>
            
            <button id="favorites-filter" class="inline-flex items-center gap-1 rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800" data-active="false">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
              Favorites
            </button>
            
            <div class="relative">
              <select id="tag-filter" class="rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none text-sm">
                <option value="">All Tags</option>
              </select>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div class="relative">
              <button id="export-btn" class="inline-flex items-center gap-2 rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>
                Export
                <svg class="h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
              </button>
              <div id="export-menu" class="absolute right-0 mt-1 w-32 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg z-10 hidden">
                <button id="export-json" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-xl">JSON</button>
                <button id="export-csv" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-xl">CSV</button>
              </div>
            </div>
            <div class="relative">
              <button id="import-btn" class="inline-flex items-center gap-2 rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/></svg>
                Import
                <svg class="h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
              </button>
              <div id="import-menu" class="absolute right-0 mt-1 w-32 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg z-10 hidden">
                <button id="import-json" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-xl">JSON</button>
                <button id="import-csv" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-xl">CSV</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Notes Grid -->
    <!-- Hidden file input for imports -->
    <input type="file" id="file-input" accept=".json,.csv" style="display: none;">

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 mb-24">
      <div id="empty-state" class="rounded-2xl border border-dashed border-gray-300 dark:border-gray-700 p-8 text-center text-gray-500 dark:text-gray-400">
        No notes yet. Add your first English–Indonesian pair above.
      </div>
      <div id="notes-container" class="mt-4 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
    </main>

    <!-- Review Modal -->
    <div id="review-modal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto mt-20 max-w-xl px-4">
        <div class="rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl">
          <div class="flex items-center justify-between px-4 pt-4">
            <div id="review-progress" class="text-sm text-gray-500 dark:text-gray-400">0 / 0</div>
            <button id="review-close" class="rounded-lg border border-gray-300 dark:border-gray-700 px-3 py-1 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Close</button>
          </div>
          <div class="px-4 pb-4">
            <div id="review-card" class="mt-2 rounded-xl border border-gray-200 dark:border-gray-800 p-6 bg-white dark:bg-gray-800 flip" data-flipped="false">
              <div class="flip-inner">
                <div class="flip-face">
                  <div id="review-front-en" class="text-2xl font-bold tracking-tight"></div>
                </div>
                <div class="flip-face flip-back">
                  <div id="review-back-id" class="text-2xl font-bold tracking-tight"></div>
                </div>
              </div>
            </div>
            <div class="mt-4 flex justify-center">
              <button id="review-show" class="inline-flex items-center gap-2 rounded-xl border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Show answer (Space)</button>
            </div>
            <div id="review-grades" class="mt-3 grid grid-cols-4 gap-2 hidden">
              <button id="grade-again" class="rounded-xl bg-red-600 text-white px-3 py-2 text-sm hover:bg-red-700">Again</button>
              <button id="grade-hard" class="rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Hard</button>
              <button id="grade-good" class="rounded-xl bg-blue-600 text-white px-3 py-2 text-sm hover:bg-blue-700">Good</button>
              <button id="grade-easy" class="rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Easy</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Service worker registration (preserved)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').then((reg) => {
          console.log('Service worker registered.', reg);
        });
      }


      // Elements
      const addNoteForm = document.getElementById('add-note-form');
      const englishWordInput = document.getElementById('english_word');
      const indonesianWordInput = document.getElementById('indonesian_word');
      const tagsInput = document.getElementById('tags_input');
      const notesContainer = document.getElementById('notes-container');
      const emptyState = document.getElementById('empty-state');
      const searchDesktop = document.getElementById('search-input');
      const searchMobile = document.getElementById('search-input-mobile');
      const sortSelect = document.getElementById('sort-select');
      const favoritesFilter = document.getElementById('favorites-filter');
      const tagFilter = document.getElementById('tag-filter');
      const countBadge = document.getElementById('count-badge');
      const themeToggle = document.getElementById('theme-toggle');
      const themeMeta = document.getElementById('theme-color');
      const clearAllBtn = document.getElementById('clear-all');
      const exportBtn = document.getElementById('export-btn');
      const importBtn = document.getElementById('import-btn');
      const exportMenu = document.getElementById('export-menu');
      const importMenu = document.getElementById('import-menu');
      const exportJsonBtn = document.getElementById('export-json');
      const exportCsvBtn = document.getElementById('export-csv');
      const importJsonBtn = document.getElementById('import-json');
      const importCsvBtn = document.getElementById('import-csv');
      const fileInput = document.getElementById('file-input');

      // Review elements
      const reviewBtn = document.getElementById('review-btn');
      const dueBadge = document.getElementById('due-badge');
      const reviewModal = document.getElementById('review-modal');
      const reviewProgress = document.getElementById('review-progress');
      const reviewCard = document.getElementById('review-card');
      const reviewFrontEn = document.getElementById('review-front-en');
      const reviewBackId = document.getElementById('review-back-id');
      const reviewShow = document.getElementById('review-show');
      const reviewGrades = document.getElementById('review-grades');
      const reviewClose = document.getElementById('review-close');
      const gradeAgain = document.getElementById('grade-again');
      const gradeHard = document.getElementById('grade-hard');
      const gradeGood = document.getElementById('grade-good');
      const gradeEasy = document.getElementById('grade-easy');

      // State
      let notes = [];
      let filterText = '';
      let showFavoritesOnly = false;
      let selectedTag = '';
      let reviewQueue = [];
      let reviewIndex = 0;

      // Storage helpers
      const NOTES_KEY = 'notes-data-v1';
      const THEME_KEY = 'theme-preference';
      function saveNotes() { localStorage.setItem(NOTES_KEY, JSON.stringify(notes)); }
      function loadNotes() {
        try { notes = JSON.parse(localStorage.getItem(NOTES_KEY) || '[]'); }
        catch { notes = []; }
      }

      // Scheduling (SM-2) helpers
      function ensureSchedule(n) {
        if (n.ease == null) n.ease = 2.5;
        if (n.repetitions == null) n.repetitions = 0;
        if (n.interval == null) n.interval = 0; // in days
        if (n.lapses == null) n.lapses = 0;
        if (n.lastReviewedAt == null) n.lastReviewedAt = 0;
        if (n.dueAt == null) n.dueAt = Date.now();
      }
      function ensureScheduleForAll() { notes.forEach(ensureSchedule); }
      function getDueNotes() {
        const now = Date.now();
        return notes.filter(n => (n.dueAt || 0) <= now);
      }
      function updateDueBadge() {
        if (!dueBadge) return;
        const due = getDueNotes().length;
        dueBadge.textContent = `${due} due`;
        // Color hinting already styled; nothing else needed
      }
      function sm2Review(n, q) {
        ensureSchedule(n);
        // Update ease factor
        let ease = n.ease;
        ease = ease + (0.1 - (5 - q) * (0.08 + (5 - q) * 0.02));
        if (ease < 1.3) ease = 1.3;

        if (q < 3) {
          n.repetitions = 0;
          n.lapses = (n.lapses || 0) + 1;
          n.interval = 1; // schedule for tomorrow
        } else {
          n.repetitions = (n.repetitions || 0) + 1;
          if (n.repetitions === 1) n.interval = 1;
          else if (n.repetitions === 2) n.interval = 6;
          else n.interval = Math.round((n.interval || 1) * ease);
        }

        n.ease = ease;
        n.lastReviewedAt = Date.now();
        n.dueAt = n.lastReviewedAt + n.interval * 86400000; // ms in a day
      }

      function startReview() {
        reviewQueue = getDueNotes().sort((a, b) => (a.dueAt || 0) - (b.dueAt || 0));
        if (reviewQueue.length === 0) {
          alert('No cards are due for review right now.');
          return;
        }
        reviewIndex = 0;
        showCurrentReviewCard();
        reviewModal.classList.remove('hidden');
      }
      function closeReview() {
        reviewModal.classList.add('hidden');
        reviewQueue = [];
        reviewIndex = 0;
      }
      function showCurrentReviewCard() {
        const n = reviewQueue[reviewIndex];
        if (!n) return;
        reviewCard.setAttribute('data-flipped', 'false');
        reviewFrontEn.textContent = n.en;
        reviewBackId.textContent = n.id;
        reviewProgress.textContent = `${reviewIndex + 1} / ${reviewQueue.length}`;
        reviewShow.classList.remove('hidden');
        reviewGrades.classList.add('hidden');
      }
      function revealAnswer() {
        reviewCard.setAttribute('data-flipped', 'true');
        reviewShow.classList.add('hidden');
        reviewGrades.classList.remove('hidden');
      }
      function gradeAndNext(q) {
        const n = reviewQueue[reviewIndex];
        if (!n) return;
        sm2Review(n, q);
        saveNotes();
        updateDueBadge();
        reviewIndex++;
        if (reviewIndex >= reviewQueue.length) {
          reviewModal.classList.add('hidden');
          alert('Review complete!');
          renderNotes();
          return;
        }
        showCurrentReviewCard();
      }

      // Theme helpers
      function applyTheme(theme) {
        const root = document.documentElement;
        if (theme === 'dark') {
          root.classList.add('dark');
          themeMeta.setAttribute('content', '#111827'); // gray-900
        } else {
          root.classList.remove('dark');
          themeMeta.setAttribute('content', '#ffffff');
        }
      }
      function initTheme() {
        const stored = localStorage.getItem(THEME_KEY);
        const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = stored || (preferDark ? 'dark' : 'light');
        applyTheme(theme);
      }

      // Rendering
      function updateCount() { countBadge.textContent = String(notes.length); }
      function setEmptyStateVisible(isVisible) { emptyState.style.display = isVisible ? '' : 'none'; }

      function updateTagFilter() {
        const allTags = [...new Set(notes.flatMap(note => note.tags || []))].sort();
        const currentValue = tagFilter.value;
        tagFilter.innerHTML = '<option value="">All Tags</option>';
        allTags.forEach(tag => {
          const option = document.createElement('option');
          option.value = tag;
          option.textContent = tag.charAt(0).toUpperCase() + tag.slice(1);
          tagFilter.appendChild(option);
        });
        if (allTags.includes(currentValue)) {
          tagFilter.value = currentValue;
        }
      }

      function renderNotes() {
        // Filter and sort
        const q = filterText.trim().toLowerCase();
        let view = notes.filter(n => {
          // Text search
          const matchesText = n.en.toLowerCase().includes(q) || 
                             n.id.toLowerCase().includes(q) ||
                             (n.tags && n.tags.some(tag => tag.toLowerCase().includes(q)));
          
          // Favorites filter
          const matchesFavorites = !showFavoritesOnly || n.isFavorite;
          
          // Tag filter
          const matchesTag = !selectedTag || (n.tags && n.tags.includes(selectedTag));
          
          return matchesText && matchesFavorites && matchesTag;
        });
        
        const sort = sortSelect.value;
        view.sort((a,b) => {
          if (sort === 'newest') return b.createdAt - a.createdAt;
          if (sort === 'oldest') return a.createdAt - b.createdAt;
          if (sort === 'a-z') return a.en.localeCompare(b.en);
          if (sort === 'z-a') return b.en.localeCompare(a.en);
          return 0;
        });

        notesContainer.innerHTML = '';
        view.forEach(n => notesContainer.appendChild(createNoteElement(n)));
        setEmptyStateVisible(view.length === 0);
        updateCount();
      }

      // Card element factory
      function createNoteElement(note) {
        const card = document.createElement('div');
        card.className = 'group relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-800 shadow-sm hover:shadow-md transition overflow-hidden flip';
        card.setAttribute('data-id', note.id);
        card.setAttribute('tabindex', '0');

        const inner = document.createElement('div');
        inner.className = 'flip-inner p-4 min-h-[120px]';

        const front = document.createElement('div');
        front.className = 'flip-face flex h-full flex-col justify-between';
        const frontTags = note.tags && note.tags.length > 0 ? 
          `<div class="flex flex-wrap gap-1 mt-1">${note.tags.map(tag => `<span class="inline-block bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded-full">${escapeHtml(tag)}</span>`).join('')}</div>` : '';
        front.innerHTML = `
          <div>
            <div class="text-lg font-semibold tracking-tight">${escapeHtml(note.en)}</div>
            ${frontTags}
          </div>
          <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">Tap to flip</div>
        `;

        const back = document.createElement('div');
        back.className = 'flip-face flip-back flex h-full flex-col justify-between';
        const backTags = note.tags && note.tags.length > 0 ? 
          `<div class="flex flex-wrap gap-1 mt-1">${note.tags.map(tag => `<span class="inline-block bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded-full">${escapeHtml(tag)}</span>`).join('')}</div>` : '';
        back.innerHTML = `
          <div>
            <div class="text-lg font-semibold tracking-tight">${escapeHtml(note.id)}</div>
            ${backTags}
          </div>
          <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">Tap to flip back</div>
        `;

        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);

        // Actions bar
        const actions = document.createElement('div');
        actions.className = 'absolute right-2 top-2 flex gap-1 opacity-0 group-hover:opacity-100 transition';
        const starFilled = note.isFavorite ? 'fill-yellow-400 text-yellow-400' : 'text-gray-400';
        actions.innerHTML = `
          <button class="btn-star p-2 rounded-lg bg-white/80 dark:bg-gray-900/80 border border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-900" title="${note.isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
            <svg class="h-4 w-4 ${starFilled}" xmlns="http://www.w3.org/2000/svg" fill="${note.isFavorite ? 'currentColor' : 'none'}" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
          </button>
          <button class="btn-copy p-2 rounded-lg bg-white/80 dark:bg-gray-900/80 border border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-900" title="Copy">
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6M8 16v2a2 2 0 002 2h6"/></svg>
          </button>
          <button class="btn-edit p-2 rounded-lg bg-white/80 dark:bg-gray-900/80 border border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-900" title="Edit">
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4h2m2 0h2m-6 0H9m0 0H7m4 0v2m0 2v2m0-6v-2m0 10l-2 2m0 0l-2 2m4-4l2-2m0 0l2-2"/></svg>
          </button>
          <button class="btn-delete p-2 rounded-lg bg-red-50/80 dark:bg-red-900/20 border border-red-200/70 dark:border-red-800/50 hover:bg-red-100 dark:hover:bg-red-900/30" title="Delete">
            <svg class="h-4 w-4 text-red-600 dark:text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          </button>
        `;
        card.appendChild(actions);

        // Flip on click or Enter/Space
        card.addEventListener('click', (e) => {
          const isButton = e.target.closest('button');
          if (isButton) return;
          toggleFlip(card);
        });
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleFlip(card); }
        });

        return card;
      }

      function toggleFlip(card) {
        const flipped = card.getAttribute('data-flipped') === 'true';
        card.setAttribute('data-flipped', flipped ? 'false' : 'true');
      }

      // Escape helper to prevent injection in templates
      function escapeHtml(str) {
        return String(str).replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
      }

      // CRUD helpers
      function addNote(en, id, tags = []) {
        const note = { 
          id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2), 
          en: en.trim(), 
          id: id.trim(), 
          tags: tags.filter(tag => tag.trim()).map(tag => tag.trim().toLowerCase()),
          isFavorite: false,
          createdAt: Date.now(),
          // Scheduling defaults
          ease: 2.5,
          repetitions: 0,
          interval: 0,
          lapses: 0,
          lastReviewedAt: 0,
          dueAt: Date.now()
        };
        notes.unshift(note);
        saveNotes();
        renderNotes();
        updateTagFilter();
        updateDueBadge();
      }
      function deleteNote(noteId) {
        notes = notes.filter(n => n.id !== noteId);
        saveNotes();
        renderNotes();
      }
      function updateNote(noteId, en, id, tags = []) {
        const idx = notes.findIndex(n => n.id === noteId);
        if (idx !== -1) {
          notes[idx].en = en.trim();
          notes[idx].id = id.trim();
          notes[idx].tags = tags.filter(tag => tag.trim()).map(tag => tag.trim().toLowerCase());
          saveNotes();
          renderNotes();
          updateTagFilter();
        }
      }
      
      function toggleFavorite(noteId) {
        const idx = notes.findIndex(n => n.id === noteId);
        if (idx !== -1) {
          notes[idx].isFavorite = !notes[idx].isFavorite;
          saveNotes();
          renderNotes();
        }
      }

      // Inline edit UI
      function startInlineEdit(card) {
        const id = card.getAttribute('data-id');
        const n = notes.find(x => x.id === id);
        if (!n) return;
        card.innerHTML = '';
        const wrap = document.createElement('div');
        wrap.className = 'p-4 space-y-2';
        wrap.innerHTML = `
          <input id="edit-en" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="${escapeHtml(n.en)}" />
          <input id="edit-id" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="${escapeHtml(n.id)}" />
          <input id="edit-tags" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tags (comma-separated)" value="${escapeHtml((n.tags || []).join(', '))}" />
          <div class="flex gap-2 justify-end pt-1">
            <button class="btn-cancel rounded-xl border border-gray-300 dark:border-gray-700 px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800">Cancel</button>
            <button class="btn-save rounded-xl bg-blue-600 text-white px-3 py-2 text-sm hover:bg-blue-700">Save</button>
          </div>
        `;
        card.classList.remove('flip');
        card.appendChild(wrap);
        wrap.querySelector('#edit-en').focus();
      }

      // Event wiring
      addNoteForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const en = englishWordInput.value.trim();
        const id = indonesianWordInput.value.trim();
        const tags = tagsInput.value.trim() ? tagsInput.value.split(',').map(t => t.trim()).filter(t => t) : [];
        if (!en || !id) return;
        addNote(en, id, tags);
        englishWordInput.value = '';
        indonesianWordInput.value = '';
        tagsInput.value = '';
        englishWordInput.focus();
      });

      clearAllBtn.addEventListener('click', () => {
        if (notes.length === 0) return;
        if (confirm('Clear all notes? This cannot be undone.')) {
          notes = [];
          saveNotes();
          renderNotes();
        }
      });

      function onSearchInput(e) {
        filterText = e.target.value || '';
        renderNotes();
      }
      searchDesktop?.addEventListener('input', onSearchInput);
      searchMobile?.addEventListener('input', onSearchInput);

      sortSelect.addEventListener('change', renderNotes);
      
      // Favorites filter handler
      favoritesFilter.addEventListener('click', () => {
        showFavoritesOnly = !showFavoritesOnly;
        favoritesFilter.setAttribute('data-active', showFavoritesOnly.toString());
        favoritesFilter.style.backgroundColor = showFavoritesOnly ? 'rgb(59 130 246)' : '';
        favoritesFilter.style.color = showFavoritesOnly ? 'white' : '';
        renderNotes();
      });
      
      // Tag filter handler
      tagFilter.addEventListener('change', () => {
        selectedTag = tagFilter.value;
        renderNotes();
      });

      // Delegated actions on cards
      notesContainer.addEventListener('click', (e) => {
        const btnStar = e.target.closest('.btn-star');
        const btnCopy = e.target.closest('.btn-copy');
        const btnEdit = e.target.closest('.btn-edit');
        const btnDelete = e.target.closest('.btn-delete');
        const btnSave = e.target.closest('.btn-save');
        const btnCancel = e.target.closest('.btn-cancel');
        const card = e.target.closest('[data-id]');
        if (!card) return;
        const id = card.getAttribute('data-id');
        const n = notes.find(x => x.id === id);
        if (btnStar) {
          toggleFavorite(id);
        } else if (btnCopy && n) {
          const tagsText = n.tags && n.tags.length > 0 ? ` [${n.tags.join(', ')}]` : '';
          navigator.clipboard?.writeText(`${n.en} — ${n.id}${tagsText}`);
        } else if (btnEdit) {
          startInlineEdit(card);
        } else if (btnDelete) {
          if (confirm('Delete this note?')) deleteNote(id);
        } else if (btnSave) {
          const en = card.querySelector('#edit-en').value;
          const idn = card.querySelector('#edit-id').value;
          const tagsText = card.querySelector('#edit-tags').value;
          const tags = tagsText.trim() ? tagsText.split(',').map(t => t.trim()).filter(t => t) : [];
          updateNote(id, en, idn, tags);
        } else if (btnCancel) {
          renderNotes();
        }
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e) => {
        const inInput = e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement;
        if (e.key === '/' && !inInput) {
          e.preventDefault();
          (searchDesktop || searchMobile).focus();
        }
        if (e.key.toLowerCase() === 'n' && !inInput) {
          e.preventDefault();
          englishWordInput.focus();
        }
        if (e.key.toLowerCase() === 'd' && !inInput) {
          e.preventDefault();
          const dark = document.documentElement.classList.contains('dark');
          const next = dark ? 'light' : 'dark';
          localStorage.setItem(THEME_KEY, next);
          applyTheme(next);
        }
        if (e.key.toLowerCase() === 'r' && !inInput) {
          e.preventDefault();
          startReview();
        }
        // Review modal shortcuts
        const modalOpen = !reviewModal.classList.contains('hidden');
        if (modalOpen) {
          if (e.key === ' ' && reviewShow && !reviewShow.classList.contains('hidden')) {
            e.preventDefault();
            revealAnswer();
          } else if (['1','2','3','4'].includes(e.key) && !reviewGrades.classList.contains('hidden')) {
            e.preventDefault();
            const map = { '1': 1, '2': 3, '3': 4, '4': 5 };
            gradeAndNext(map[e.key]);
          } else if (e.key === 'Escape') {
            e.preventDefault();
            closeReview();
          }
        }
      });

      // Theme toggle button
      themeToggle.addEventListener('click', () => {
        const dark = document.documentElement.classList.contains('dark');
        const next = dark ? 'light' : 'dark';
        localStorage.setItem(THEME_KEY, next);
        applyTheme(next);
      });

      // Import/Export functionality
      let currentImportType = '';

      // Toggle dropdown menus
      exportBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        exportMenu.classList.toggle('hidden');
        importMenu.classList.add('hidden');
      });

      // Review handlers
      reviewBtn.addEventListener('click', startReview);
      reviewClose.addEventListener('click', closeReview);
      reviewShow.addEventListener('click', revealAnswer);
      gradeAgain.addEventListener('click', () => gradeAndNext(1));
      gradeHard.addEventListener('click', () => gradeAndNext(3));
      gradeGood.addEventListener('click', () => gradeAndNext(4));
      gradeEasy.addEventListener('click', () => gradeAndNext(5));

      importBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        importMenu.classList.toggle('hidden');
        exportMenu.classList.add('hidden');
      });

      // Close menus when clicking outside
      document.addEventListener('click', () => {
        exportMenu.classList.add('hidden');
        importMenu.classList.add('hidden');
      });

      // Export functions
      function exportAsJSON() {
        const exportData = {
          version: '1.1',
          exportDate: new Date().toISOString(),
          totalNotes: notes.length,
          notes: notes.map(note => ({
            id: note.id,
            english: note.en,
            indonesian: note.id,
            tags: note.tags || [],
            isFavorite: note.isFavorite || false,
            createdAt: note.createdAt,
            createdDate: new Date(note.createdAt).toISOString(),
            // Scheduling fields
            dueAt: note.dueAt ?? null,
            interval: note.interval ?? null,
            repetitions: note.repetitions ?? null,
            ease: note.ease ?? null,
            lastReviewedAt: note.lastReviewedAt ?? null,
            lapses: note.lapses ?? null
          }))
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `notes-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        exportMenu.classList.add('hidden');
      }

      function exportAsCSV() {
        const headers = ['English', 'Indonesian', 'Tags', 'Favorite', 'Created Date'];
        const csvRows = [headers.join(',')];
        
        notes.forEach(note => {
          const row = [
            `"${note.en.replace(/"/g, '""')}"`,
            `"${note.id.replace(/"/g, '""')}"`,
            `"${(note.tags || []).join(', ').replace(/"/g, '""')}"`,
            `"${note.isFavorite ? 'Yes' : 'No'}"`,
            `"${new Date(note.createdAt).toISOString()}"`
          ];
          csvRows.push(row.join(','));
        });
        
        const csvStr = csvRows.join('\n');
        const dataBlob = new Blob([csvStr], { type: 'text/csv' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `notes-backup-${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        
        exportMenu.classList.add('hidden');
      }

      // Import functions
      function importFromJSON(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const importData = JSON.parse(e.target.result);
            let importNotes = [];
            
            // Handle different JSON structures
            if (importData.notes && Array.isArray(importData.notes)) {
              // New format with metadata
              importNotes = importData.notes;
            } else if (importData.vocabulary && Array.isArray(importData.vocabulary)) {
              // Vocabulary format (like data.json)
              importNotes = importData.vocabulary;
            } else if (Array.isArray(importData)) {
              // Direct array format
              importNotes = importData;
            } else {
              throw new Error('Invalid JSON format. Expected notes, vocabulary array, or direct array.');
            }
            
            let imported = 0;
            importNotes.forEach(note => {
              if (note.english && note.indonesian) {
                // New format
                const newNote = {
                  id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
                  en: note.english.trim(),
                  id: note.indonesian.trim(),
                  tags: Array.isArray(note.tags) ? note.tags.filter(tag => tag.trim()).map(tag => tag.trim().toLowerCase()) : [],
                  isFavorite: note.isFavorite || false,
                  createdAt: note.createdAt || Date.now(),
                  ease: note.ease ?? 2.5,
                  repetitions: note.repetitions ?? 0,
                  interval: note.interval ?? 0,
                  lapses: note.lapses ?? 0,
                  lastReviewedAt: note.lastReviewedAt ?? 0,
                  dueAt: note.dueAt ?? Date.now()
                };
                notes.unshift(newNote);
                imported++;
              } else if (note.en && note.id) {
                // Old format compatibility
                const newNote = {
                  id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
                  en: note.en.trim(),
                  id: note.id.trim(),
                  tags: Array.isArray(note.tags) ? note.tags.filter(tag => tag.trim()).map(tag => tag.trim().toLowerCase()) : [],
                  isFavorite: note.isFavorite || false,
                  createdAt: note.createdAt || Date.now(),
                  ease: note.ease ?? 2.5,
                  repetitions: note.repetitions ?? 0,
                  interval: note.interval ?? 0,
                  lapses: note.lapses ?? 0,
                  lastReviewedAt: note.lastReviewedAt ?? 0,
                  dueAt: note.dueAt ?? Date.now()
                };
                notes.unshift(newNote);
                imported++;
              }
            });
            
            saveNotes();
            updateTagFilter();
            renderNotes();
            alert(`Successfully imported ${imported} notes!`);
          } catch (error) {
            alert('Error importing JSON file: ' + error.message);
          }
        };
        reader.readAsText(file);
      }

      function importFromCSV(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const csvText = e.target.result;
            const lines = csvText.split('\n').filter(line => line.trim());
            
            if (lines.length < 2) {
              throw new Error('CSV file must have at least a header and one data row');
            }
            
            // Skip header row
            const dataLines = lines.slice(1);
            let imported = 0;
            
            dataLines.forEach(line => {
              // Simple CSV parser (handles quoted fields)
              const fields = [];
              let current = '';
              let inQuotes = false;
              
              for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                  if (inQuotes && line[i + 1] === '"') {
                    current += '"';
                    i++; // Skip next quote
                  } else {
                    inQuotes = !inQuotes;
                  }
                } else if (char === ',' && !inQuotes) {
                  fields.push(current);
                  current = '';
                } else {
                  current += char;
                }
              }
              fields.push(current); // Add last field
              
              if (fields.length >= 2 && fields[0].trim() && fields[1].trim()) {
                const tagsField = fields[2] ? fields[2].trim() : '';
                const tags = tagsField ? tagsField.split(',').map(tag => tag.trim().toLowerCase()).filter(tag => tag) : [];
                const isFavorite = fields[3] ? (fields[3].trim().toLowerCase() === 'yes' || fields[3].trim().toLowerCase() === 'true') : false;
                const createdAt = fields[4] ? new Date(fields[4]).getTime() || Date.now() : Date.now();
                
                const newNote = {
                  id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
                  en: fields[0].trim(),
                  id: fields[1].trim(),
                  tags: tags,
                  isFavorite: isFavorite,
                  createdAt: createdAt
                };
                notes.unshift(newNote);
                imported++;
              }
            });
            
            saveNotes();
            updateTagFilter();
            renderNotes();
            alert(`Successfully imported ${imported} notes from CSV!`);
          } catch (error) {
            alert('Error importing CSV file: ' + error.message);
          }
        };
        reader.readAsText(file);
      }

      // Event handlers for export buttons
      exportJsonBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (notes.length === 0) {
          alert('No notes to export!');
          return;
        }
        exportAsJSON();
      });

      exportCsvBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (notes.length === 0) {
          alert('No notes to export!');
          return;
        }
        exportAsCSV();
      });

      // Event handlers for import buttons
      importJsonBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentImportType = 'json';
        fileInput.accept = '.json';
        fileInput.click();
        importMenu.classList.add('hidden');
      });

      importCsvBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentImportType = 'csv';
        fileInput.accept = '.csv';
        fileInput.click();
        importMenu.classList.add('hidden');
      });

      // File input change handler
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        if (currentImportType === 'json') {
          if (!file.name.toLowerCase().endsWith('.json')) {
            alert('Please select a JSON file');
            return;
          }
          importFromJSON(file);
        } else if (currentImportType === 'csv') {
          if (!file.name.toLowerCase().endsWith('.csv')) {
            alert('Please select a CSV file');
            return;
          }
          importFromCSV(file);
        }
        
        // Reset file input
        fileInput.value = '';
      });

      // Init
      initTheme();
      loadNotes();
      ensureScheduleForAll();
      updateTagFilter();
      renderNotes();
      updateDueBadge();
    </script>
</body>
</html>
